---
title: "Grammar of Graphics: Module 2"
subtitle: "Aesthetics, Faceting & Themes"
author: "Sparrow"
date: today
format: 
  revealjs:
    theme: serif
    css: ../../assets/slide_deck.css
    include-after-body: footer.html
    slide-number: true
    navigation-mode: linear
    code-copy: true
    code-fold: true
    chalkboard: true
    preview-links: true
    center: true
    zoom: true
---

## Module 2 Overview {.smaller}

**Previously (Module 1)**:
- Grammar of Graphics foundations
- Seven layers
- Basic geoms

**This Module**:
- Aesthetic mappings deep dive
- Faceting strategies
- Built-in themes
- ggthemes package

## Setup: Load Data

```{r}
#| echo: true
#| message: false
#| warning: false

library(ggplot2)
library(dplyr)
library(tidyr)
library(readxl)
library(ggthemes)  # For additional themes

# Load and prepare data
bp_data <- read_excel("../../data/PublicHealth_BP_Dataset.xlsx") %>%
  mutate(
    SysBP_Change = SysBP_6m - SysBP_0m,
    AgeGroup = cut(Age, breaks = c(0, 30, 50, 65, 100),
                   labels = c("18-30", "31-50", "51-65", "65+")),
    Hypertension_Baseline = ifelse(SysBP_0m >= 140 | DiaBP_0m >= 90, 
                                   "Hypertensive", "Normal"),
    BMI_Category = cut(BMI, breaks = c(0, 18.5, 25, 30, 100),
                       labels = c("Underweight", "Normal", "Overweight", "Obese"))
  )

# Time series data
bp_time <- bp_data %>%
  select(PatientID, TreatmentGroup, SysBP_0m, SysBP_3m, SysBP_6m) %>%
  pivot_longer(cols = starts_with("SysBP"),
               names_to = "Time", values_to = "SysBP") %>%
  mutate(Months = as.numeric(gsub("SysBP_|m", "", Time)))

bp_summary <- bp_time %>%
  group_by(TreatmentGroup, Months) %>%
  summarise(Mean_SysBP = mean(SysBP, na.rm = TRUE), .groups = "drop")
```

# Section 1: Aesthetic Mappings Deep Dive {background-color="#2C5F8D"}

## Global vs Local Aesthetics {.smaller}

::: {.incremental}
- **Global aesthetics**: Defined in `ggplot()`, apply to all layers
- **Local aesthetics**: Defined in `geom_*()`, apply to specific layer
- Local aesthetics **override** global aesthetics
- Use global for shared mappings, local for layer-specific mappings
:::

```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|1|2|3"

ggplot(data, aes(x = var1, y = var2)) +          # Global
  geom_point(aes(color = var3)) +                 # Local (adds color)
  geom_smooth()                                   # Uses global only
```

## Global Aesthetics Example

:::: {.columns}
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|1-2|3|4"

# Global color applies to both layers
ggplot(bp_data, 
       aes(x = Age, y = SysBP_0m, 
           color = TreatmentGroup)) +
  geom_point(size = 3, alpha = 0.6) +
  geom_smooth(method = "lm", se = FALSE)
```

::: {.fragment}
Both `geom_point()` and `geom_smooth()` use the color mapping
:::
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| message: false
#| fig-width: 6
#| fig-height: 5

ggplot(bp_data, aes(x = Age, y = SysBP_0m, color = TreatmentGroup)) +
  geom_point(size = 2, alpha = 0.6) +
  geom_smooth(method = "lm", se = FALSE, linewidth = 1.2) +
  labs(title = "Global Aesthetics",
       x = "Age (years)",
       y = "Systolic BP (mmHg)") +
  theme_minimal(base_size = 12)
```
:::
::::

## Local Aesthetics Override

:::: {.columns}
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|1-2|3|4"

# Local aesthetic overrides global
ggplot(bp_data, 
       aes(x = Age, y = SysBP_0m)) +
  geom_point(aes(color = TreatmentGroup), 
             size = 3, alpha = 0.6) +
  geom_smooth(method = "lm", 
              color = "black", linewidth = 1.5)
```

::: {.fragment}
Points are colored by treatment, but smooth line is black
:::
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| message: false
#| fig-width: 6
#| fig-height: 5

ggplot(bp_data, aes(x = Age, y = SysBP_0m)) +
  geom_point(aes(color = TreatmentGroup), size = 2, alpha = 0.6) +
  geom_smooth(method = "lm", color = "black", linewidth = 1.5) +
  labs(title = "Local Override",
       x = "Age (years)",
       y = "Systolic BP (mmHg)") +
  theme_minimal(base_size = 12)
```
:::
::::

## Common Aesthetics: Color & Fill

:::: {.columns}
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|2-3"

ggplot(bp_data, 
       aes(x = Region, y = SysBP_0m,
           fill = Region)) +
  geom_boxplot(alpha = 0.7)
```

::: {.fragment}
**color**: Outlines of geoms (points, lines)  
**fill**: Interior of geoms (bars, areas, polygons)
:::
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| fig-width: 6
#| fig-height: 5

ggplot(bp_data, aes(x = Region, y = SysBP_0m, fill = Region)) +
  geom_boxplot(alpha = 0.7) +
  labs(title = "Fill Aesthetic",
       x = "Region",
       y = "Systolic BP (mmHg)") +
  theme_minimal(base_size = 12) +
  theme(legend.position = "none")
```
:::
::::

## Common Aesthetics: Size

:::: {.columns}
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|2-3"

ggplot(bp_data, 
       aes(x = Age, y = SysBP_0m,
           size = BMI, color = TreatmentGroup)) +
  geom_point(alpha = 0.6)
```

::: {.fragment}
**size**: Point size or line width, mapped to continuous variable
:::
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| fig-width: 6
#| fig-height: 5

ggplot(bp_data, aes(x = Age, y = SysBP_0m, size = BMI, color = TreatmentGroup)) +
  geom_point(alpha = 0.6) +
  labs(title = "Size Aesthetic") +
  theme_minimal(base_size = 11)
```
:::
::::

## Common Aesthetics: Shape

:::: {.columns}
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|2-3"

ggplot(bp_data, 
       aes(x = Age, y = Cholesterol,
           shape = Gender, 
           color = Gender)) +
  geom_point(size = 3, alpha = 0.7)
```

::: {.fragment}
**shape**: Point shape (circles, squares, triangles, etc.)  
Best for categorical variables with few levels (≤6)
:::
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| fig-width: 6
#| fig-height: 5

ggplot(bp_data, aes(x = Age, y = Cholesterol, shape = Gender, color = Gender)) +
  geom_point(size = 2.5, alpha = 0.7) +
  labs(title = "Shape Aesthetic") +
  theme_minimal(base_size = 12)
```
:::
::::

## Common Aesthetics: Alpha (Transparency)

:::: {.columns}
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|2-3"

ggplot(bp_data, 
       aes(x = BMI, y = SysBP_0m,
           alpha = Cholesterol)) +
  geom_point(size = 3, color = "darkred")
```

::: {.fragment}
**alpha**: Transparency (0 = transparent, 1 = opaque)  
Useful for showing density in overplotted data
:::
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| fig-width: 6
#| fig-height: 5

ggplot(bp_data, aes(x = BMI, y = SysBP_0m, alpha = Cholesterol)) +
  geom_point(size = 2.5, color = "darkred") +
  labs(title = "Alpha Aesthetic") +
  theme_minimal(base_size = 12)
```
:::
::::

## Multiple Aesthetics Combined

:::: {.columns}
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|1-5"

ggplot(bp_data, 
       aes(x = Age, y = SysBP_0m,
           color = TreatmentGroup,
           shape = Gender,
           size = BMI)) +
  geom_point(alpha = 0.6)
```

::: {.fragment}
Can combine multiple aesthetics, but be careful not to overwhelm!
:::
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| fig-width: 6
#| fig-height: 5

ggplot(bp_data, aes(x = Age, y = SysBP_0m, color = TreatmentGroup, shape = Gender, size = BMI)) +
  geom_point(alpha = 0.6) +
  labs(title = "Multiple Aesthetics") +
  theme_minimal(base_size = 11)
```
:::
::::

## Aesthetic Mapping: Inside vs Outside aes()

:::: {.columns}
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|3-4|7-8"

# MAPPED to data (inside aes)
ggplot(bp_data, 
       aes(x = Age, y = SysBP_0m,
           color = TreatmentGroup)) +
  geom_point(size = 3)

# FIXED value (outside aes)
ggplot(bp_data, 
       aes(x = Age, y = SysBP_0m)) +
  geom_point(color = "blue", size = 3)
```

::: {.fragment}
**Key rule**: Inside `aes()` = mapped to data, Outside = fixed value
:::
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| fig-width: 6
#| fig-height: 5.5

library(patchwork)
p1 <- ggplot(bp_data, aes(x = Age, y = SysBP_0m, color = TreatmentGroup)) +
  geom_point(size = 2) +
  labs(title = "Mapped (inside aes)") +
  theme_minimal(base_size = 10)

p2 <- ggplot(bp_data, aes(x = Age, y = SysBP_0m)) +
  geom_point(color = "blue", size = 2) +
  labs(title = "Fixed (outside aes)") +
  theme_minimal(base_size = 10)

p1 / p2
```
:::
::::

## Common Pitfall: Mapping Constants

:::: {.columns}
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|2|7"

# WRONG - Don't map constants
ggplot(bp_data, 
       aes(x = Age, y = SysBP_0m,
           color = "blue")) +        # ❌
  geom_point()

# CORRECT - Set fixed values outside aes
ggplot(bp_data, 
       aes(x = Age, y = SysBP_0m)) +
  geom_point(color = "blue")         # ✓
```
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| fig-width: 6
#| fig-height: 5.5

p1 <- ggplot(bp_data, aes(x = Age, y = SysBP_0m, color = "blue")) +
  geom_point(size = 2) +
  labs(title = "Wrong: Mapped constant") +
  theme_minimal(base_size = 10)

p2 <- ggplot(bp_data, aes(x = Age, y = SysBP_0m)) +
  geom_point(color = "blue", size = 2) +
  labs(title = "Correct: Fixed value") +
  theme_minimal(base_size = 10)

p1 / p2
```
:::
::::

# Section 2: Faceting Strategies {background-color="#2C5F8D"}

## facet_wrap(): Single Variable Faceting

:::: {.columns}
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|4"

ggplot(bp_data, 
       aes(x = Age, y = SysBP_0m)) +
  geom_point(alpha = 0.6, size = 2) +
  facet_wrap(~ TreatmentGroup) +
  theme_minimal()
```

::: {.fragment}
**Use for**: Creating subplots for each level of one categorical variable
:::
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| fig-width: 6
#| fig-height: 5

ggplot(bp_data, aes(x = Age, y = SysBP_0m)) +
  geom_point(alpha = 0.6, size = 2, color = "steelblue") +
  facet_wrap(~ TreatmentGroup) +
  labs(title = "Systolic BP by Age") +
  theme_minimal(base_size = 12)
```
:::
::::

## facet_wrap(): Multiple Columns

:::: {.columns}
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|4"

ggplot(bp_data, 
       aes(x = BMI, y = Cholesterol)) +
  geom_point(alpha = 0.6, color = "darkred") +
  facet_wrap(~ Region, ncol = 2) +
  theme_minimal()
```

::: {.fragment}
**ncol** parameter controls layout columns
:::
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| fig-width: 6
#| fig-height: 5

ggplot(bp_data, aes(x = BMI, y = Cholesterol)) +
  geom_point(alpha = 0.6, size = 1.5, color = "darkred") +
  facet_wrap(~ Region, ncol = 2) +
  labs(title = "BMI vs Cholesterol by Region") +
  theme_minimal(base_size = 11)
```
:::
::::

## facet_grid(): Two Variable Grid

:::: {.columns}
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|4"

ggplot(bp_data, 
       aes(x = Age, y = SysBP_0m)) +
  geom_point(alpha = 0.5, size = 1.5) +
  facet_grid(Gender ~ TreatmentGroup) +
  theme_minimal()
```

::: {.fragment}
**Use for**: Creating a grid with rows and columns from two variables  
Formula: `rows ~ columns`
:::
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| fig-width: 6
#| fig-height: 5

ggplot(bp_data, aes(x = Age, y = SysBP_0m)) +
  geom_point(alpha = 0.5, size = 1.5, color = "steelblue") +
  facet_grid(Gender ~ TreatmentGroup) +
  labs(title = "Systolic BP by Gender & Treatment") +
  theme_minimal(base_size = 11)
```
:::
::::

## Free Scales in Facets

:::: {.columns}
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|1-3|8"

# Create data with different ranges
smoking_bp <- bp_data %>%
  filter(!is.na(SmokingStatus)) %>%
  pivot_longer(cols = c(SysBP_0m, DiaBP_0m),
               names_to = "BP_Type",
               values_to = "Value")

ggplot(smoking_bp, aes(x = SmokingStatus, y = Value)) +
  geom_boxplot(fill = "lightblue") +
  facet_wrap(~ BP_Type, scales = "free_y")
```

::: {.fragment}
**scales**: "fixed" (default), "free", "free_x", "free_y"
:::
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| message: false
#| fig-width: 6
#| fig-height: 5

smoking_bp <- bp_data %>%
  filter(!is.na(SmokingStatus)) %>%
  select(SmokingStatus, SysBP_0m, DiaBP_0m) %>%
  pivot_longer(cols = c(SysBP_0m, DiaBP_0m),
               names_to = "BP_Type",
               values_to = "Value")

ggplot(smoking_bp, aes(x = SmokingStatus, y = Value)) +
  geom_boxplot(fill = "lightblue", alpha = 0.7) +
  facet_wrap(~ BP_Type, scales = "free_y", 
             labeller = labeller(BP_Type = c(SysBP_0m = "Systolic", DiaBP_0m = "Diastolic"))) +
  labs(title = "BP by Smoking Status") +
  theme_minimal(base_size = 10) +
  theme(axis.text.x = element_text(angle = 30, hjust = 1))
```
:::
::::

## Facets with Multiple Geoms

:::: {.columns}
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|3-5"

ggplot(bp_data, 
       aes(x = Age, y = SysBP_0m)) +
  geom_point(alpha = 0.4, size = 1.5) +
  geom_smooth(method = "lm", 
              color = "darkred", se = TRUE) +
  facet_wrap(~ TreatmentGroup) +
  theme_minimal()
```

::: {.fragment}
Each facet gets all layers - points and smooth line
:::
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| message: false
#| fig-width: 6
#| fig-height: 5

ggplot(bp_data, aes(x = Age, y = SysBP_0m)) +
  geom_point(alpha = 0.4, size = 1.5, color = "gray40") +
  geom_smooth(method = "lm", color = "darkred", se = TRUE, linewidth = 1.2) +
  facet_wrap(~ TreatmentGroup) +
  labs(title = "Age vs SysBP with Trend Lines") +
  theme_minimal(base_size = 12)
```
:::
::::

## Complex Faceting Example

:::: {.columns}
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|1-2|5-6"

# Handle missing data
bp_complete <- bp_data %>%
  filter(!is.na(ExerciseFreq))

ggplot(bp_complete, 
       aes(x = AgeGroup, y = SysBP_Change,
           fill = TreatmentGroup)) +
  geom_boxplot() +
  facet_wrap(~ ExerciseFreq, ncol = 3) +
  theme_minimal() +
  theme(axis.text.x = 
          element_text(angle = 45, hjust = 1))
```
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| fig-width: 6
#| fig-height: 5

bp_complete <- bp_data %>%
  filter(!is.na(ExerciseFreq))

ggplot(bp_complete, aes(x = AgeGroup, y = SysBP_Change, fill = TreatmentGroup)) +
  geom_boxplot(alpha = 0.7) +
  facet_wrap(~ ExerciseFreq, ncol = 3) +
  labs(title = "BP Change by Age, Treatment & Exercise",
       x = "Age Group", y = "SysBP Change (mmHg)",
       fill = "Treatment") +
  theme_minimal(base_size = 10) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
:::
::::

# Section 3: Built-in Themes {background-color="#2C5F8D"}

## Theme System Overview {.smaller}

::: {.incremental}
- Themes control **non-data elements** of plots
- Affect: fonts, colors, backgrounds, grid lines, axes
- ggplot2 includes 8 built-in complete themes
- Each theme suited for different contexts
- Can be customized further with `theme()` function
:::

::: {.fragment}
**Basic usage**: `+ theme_minimal()`
:::

## theme_gray() - Default Theme

:::: {.columns}
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|4"

ggplot(bp_data, 
       aes(x = Region, y = SysBP_0m, 
           fill = Region)) +
  geom_boxplot() +
  theme_gray(base_size = 14)
```

::: {.fragment}
**Characteristics**: Gray background, white grid lines  
**Best for**: General exploratory analysis, default choice
:::
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| fig-width: 6
#| fig-height: 5

ggplot(bp_data, aes(x = Region, y = SysBP_0m, fill = Region)) +
  geom_boxplot(alpha = 0.7) +
  labs(title = "theme_gray()") +
  theme_gray(base_size = 12) +
  theme(legend.position = "none")
```
:::
::::

## theme_bw() - Black and White

:::: {.columns}
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|4"

ggplot(bp_data, 
       aes(x = Region, y = SysBP_0m, 
           fill = Region)) +
  geom_boxplot() +
  theme_bw(base_size = 14)
```

::: {.fragment}
**Characteristics**: White background, gray grid lines, black border  
**Best for**: Professional reports, publications, clean appearance
:::
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| fig-width: 6
#| fig-height: 5

ggplot(bp_data, aes(x = Region, y = SysBP_0m, fill = Region)) +
  geom_boxplot(alpha = 0.7) +
  labs(title = "theme_bw()") +
  theme_bw(base_size = 12) +
  theme(legend.position = "none")
```
:::
::::

## theme_minimal() - Minimalist

:::: {.columns}
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|4"

ggplot(bp_data, 
       aes(x = Region, y = SysBP_0m, 
           fill = Region)) +
  geom_boxplot() +
  theme_minimal(base_size = 14)
```

::: {.fragment}
**Characteristics**: No background, minimal grid lines  
**Best for**: Presentations, modern clean look, focus on data
:::
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| fig-width: 6
#| fig-height: 5

ggplot(bp_data, aes(x = Region, y = SysBP_0m, fill = Region)) +
  geom_boxplot(alpha = 0.7) +
  labs(title = "theme_minimal()") +
  theme_minimal(base_size = 12) +
  theme(legend.position = "none")
```
:::
::::

## theme_classic() - Classic Look

:::: {.columns}
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|4"

ggplot(bp_data, 
       aes(x = Region, y = SysBP_0m, 
           fill = Region)) +
  geom_boxplot() +
  theme_classic(base_size = 14)
```

::: {.fragment}
**Characteristics**: White background, no grid, axis lines only  
**Best for**: Scientific publications, traditional journals, base R style
:::
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| fig-width: 6
#| fig-height: 5

ggplot(bp_data, aes(x = Region, y = SysBP_0m, fill = Region)) +
  geom_boxplot(alpha = 0.7) +
  labs(title = "theme_classic()") +
  theme_classic(base_size = 12) +
  theme(legend.position = "none")
```
:::
::::

## theme_light() & theme_dark()

:::: {.columns}
::: {.column width="50%"}
```{r}
#| echo: true
#| eval: false

# Light theme
ggplot(bp_data, 
       aes(x = Age, y = SysBP_0m)) +
  geom_point(color = "steelblue") +
  theme_light(base_size = 14)
```

```{r}
#| echo: false
#| fig-width: 5
#| fig-height: 4

ggplot(bp_data, aes(x = Age, y = SysBP_0m)) +
  geom_point(color = "steelblue", alpha = 0.6) +
  labs(title = "theme_light()") +
  theme_light(base_size = 11)
```
:::

::: {.column width="50%"}
```{r}
#| echo: true
#| eval: false

# Dark theme
ggplot(bp_data, 
       aes(x = Age, y = SysBP_0m)) +
  geom_point(color = "cyan") +
  theme_dark(base_size = 14)
```

```{r}
#| echo: false
#| fig-width: 5
#| fig-height: 4

ggplot(bp_data, aes(x = Age, y = SysBP_0m)) +
  geom_point(color = "cyan", alpha = 0.6) +
  labs(title = "theme_dark()") +
  theme_dark(base_size = 11)
```
:::
::::

## theme_void() - Completely Blank

:::: {.columns}
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|1-3|5"

ggplot(bp_data, 
       aes(x = Longitude, y = Latitude,
           color = Region)) +
  geom_point(size = 3, alpha = 0.7) +
  theme_void()
```

::: {.fragment}
**Characteristics**: No axes, no grid, no background  
**Best for**: Maps, specialized graphics, pure data visualization
:::
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| fig-width: 6
#| fig-height: 5

ggplot(bp_data, aes(x = Longitude, y = Latitude, color = Region)) +
  geom_point(size = 3, alpha = 0.7) +
  labs(title = "theme_void()") +
  theme_void(base_size = 12)
```
:::
::::

## Theme Comparison

```{r}
#| echo: false
#| message: false
#| fig-width: 12
#| fig-height: 8

base_plot <- ggplot(bp_data, aes(x = Age, y = SysBP_0m, color = TreatmentGroup)) +
  geom_point(alpha = 0.6, size = 2) +
  geom_smooth(method = "lm", se = FALSE, linewidth = 1.2) +
  labs(x = "Age (years)", y = "Systolic BP (mmHg)", color = "Treatment")

p1 <- base_plot + theme_gray(base_size = 11) + labs(title = "theme_gray()")
p2 <- base_plot + theme_bw(base_size = 11) + labs(title = "theme_bw()")
p3 <- base_plot + theme_minimal(base_size = 11) + labs(title = "theme_minimal()")
p4 <- base_plot + theme_classic(base_size = 11) + labs(title = "theme_classic()")

(p1 | p2) / (p3 | p4)
```

# Section 4: ggthemes Package {background-color="#2C5F8D"}

## ggthemes Package Overview {.smaller}

::: {.incremental}
- Additional themes inspired by famous publications and software
- Professional, publication-ready aesthetics
- Color palettes matching each theme
- Includes themes from: Economist, FiveThirtyEight, Tufte, WSJ, Stata, Excel, and more
:::

```{r}
#| echo: true
#| eval: false

library(ggthemes)
```

## theme_economist() - The Economist Style

:::: {.columns}
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|5-6"

ggplot(bp_summary, 
       aes(x = Months, y = Mean_SysBP,
           color = TreatmentGroup)) +
  geom_line(linewidth = 1.5) +
  scale_color_economist() +
  theme_economist()
```

::: {.fragment}
**Style**: Blue background, distinctive typography  
**Use for**: Business reports, policy documents, professional presentations
:::
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| message: false
#| fig-width: 6
#| fig-height: 5

ggplot(bp_summary, aes(x = Months, y = Mean_SysBP, color = TreatmentGroup)) +
  geom_line(linewidth = 1.5) +
  scale_color_economist() +
  theme_economist(base_size = 11) +
  labs(title = "Mean Systolic BP Over Time")
```
:::
::::

## theme_fivethirtyeight()

:::: {.columns}
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|5"

# Region summary
region_summary <- bp_data %>%
  group_by(Region) %>%
  summarise(Mean_SysBP = mean(SysBP_0m),
            N = n())

ggplot(region_summary, 
       aes(x = reorder(Region, -Mean_SysBP), 
           y = Mean_SysBP, fill = Region)) +
  geom_col() +
  theme_fivethirtyeight()
```

::: {.fragment}
**Style**: Gray background, bold colors, large text  
**Use for**: Data journalism, blog posts, engaging visualizations
:::
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| message: false
#| fig-width: 6
#| fig-height: 5

region_summary <- bp_data %>%
  group_by(Region) %>%
  summarise(Mean_SysBP = mean(SysBP_0m), N = n(), .groups = "drop")

ggplot(region_summary, aes(x = reorder(Region, -Mean_SysBP), y = Mean_SysBP, fill = Region)) +
  geom_col() +
  theme_fivethirtyeight(base_size = 11) +
  labs(title = "Mean SysBP by Region") +
  theme(legend.position = "none")
```
:::
::::

## theme_tufte() - Minimalism

:::: {.columns}
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|4"

ggplot(bp_data, 
       aes(x = Age, y = SysBP_0m)) +
  geom_point(alpha = 0.5) +
  theme_tufte(base_size = 14)
```

::: {.fragment}
**Style**: Minimal ink, maximum data-ink ratio  
**Use for**: Scientific papers, when "less is more"
:::
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| fig-width: 6
#| fig-height: 5

ggplot(bp_data, aes(x = Age, y = SysBP_0m)) +
  geom_point(alpha = 0.5, color = "black") +
  labs(title = "theme_tufte()") +
  theme_tufte(base_size = 12)
```
:::
::::

## theme_few() - Stephen Few's Style

:::: {.columns}
::: {.column width="60%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "|5-6"

ggplot(bp_data %>% filter(!is.na(BMI_Category)), 
       aes(x = BMI_Category, y = Cholesterol,
           fill = BMI_Category)) +
  geom_boxplot() +
  scale_fill_few() +
  theme_few()
```

::: {.fragment}
**Style**: Clean, professional, colorblind-friendly  
**Use for**: Business intelligence, dashboards
:::
:::

::: {.column width="40%"}
```{r}
#| echo: false
#| fig-width: 6
#| fig-height: 5

ggplot(bp_data %>% filter(!is.na(BMI_Category)), 
       aes(x = BMI_Category, y = Cholesterol, fill = BMI_Category)) +
  geom_boxplot(alpha = 0.8) +
  scale_fill_few() +
  theme_few(base_size = 11) +
  labs(title = "theme_few()") +
  theme(legend.position = "none",
        axis.text.x = element_text(angle = 20, hjust = 1))
```
:::
::::

## When to Use Which Theme? {.smaller}

| Theme | Best For | Avoid When |
|-------|----------|------------|
| `theme_gray()` | Exploratory analysis | Publications |
| `theme_bw()` | Reports, professional docs | Presentations |
| `theme_minimal()` | Presentations, modern look | Traditional journals |
| `theme_classic()` | Scientific publications | Web/digital |
| `theme_economist()` | Business reports | Academic papers |
| `theme_fivethirtyeight()` | Data journalism | Formal reports |
| `theme_tufte()` | Minimalist publications | Need context/grid |
| `theme_few()` | Dashboards, BI | Decorative needs |

## Module 2 Summary {.smaller}

**What we covered**:

::: {.incremental}
- Global vs local aesthetics
- Common aesthetic mappings (color, fill, size, shape, alpha)
- Inside vs outside aes()
- facet_wrap() and facet_grid()
- Free scales in facets
- Built-in themes (gray, bw, minimal, classic, light, dark, void)
- ggthemes package (economist, fivethirtyeight, tufte, few)
:::

::: {.fragment}
**Next in Module 3**:
- Color palettes and accessibility
- Scale functions deep dive
- Custom theme creation with theme()
:::

---

**End of Module 2**

*Continue to Module 3: Colors, Scales & Custom Themes*
