---
title: "Categorical Base Plots"
author: "Sparrow"
format:
  revealjs:
    theme: serif
    css: ../assets/slide_deck.css
    include-after-body: footer.html
    slide-number: true
    navigation-mode: linear
    code-copy: true
    chalkboard: true
    preview-links: true
    center: true
    zoom: true
execute:
  engine: knitr
  echo: false
  eval: true
  warning: false
  message: false
---

```{r setup, include=FALSE}
# Load all required libraries
library(ggplot2)
library(dplyr)
library(scales)
library(plotrix)
library(plotly)
library(vcd)
library(readxl)

# Load dataset
df <- read_excel("../../data/PublicHealth_BP_Dataset.xlsx")

# Set ggplot theme
theme_set(theme_minimal(base_size = 12))
```

# Title Slide {background-color="#f0f0f0"}

## Categorical Base Plots

**Author:** Sparrow

**Creating Effective Visualizations for Categorical Data**

---

# Single Variable Distributions

## Bar Charts: Description

::: {style="font-size: 22px; line-height: 1.8;"}

### When to Use
- Display frequency distribution of a single categorical variable
- Compare categories in terms of count or frequency
- Works best with 2-8 categories

### Requirements
- One categorical variable
- Clear category labels

### Advantages
✅ Easy to interpret and understand  
✅ Clear comparison across categories  
✅ Shows exact frequencies and percentages  
✅ Universally recognized visualization

### Limitations
❌ Not suitable for continuous data  
❌ Overcrowded with too many categories (>10)  
❌ Doesn't show relationships between variables

:::

---

## Bar Chart - Code

```r
# Step 1: Calculate frequencies and percentages
gender_data <- df %>%
  count(Gender) %>%
  mutate(
    percentage = n / sum(n) * 100,
    label = paste0(n, "\n(", round(percentage, 1), "%)")
  )
```

::: {.fragment}
```r
# Step 2: Create bar chart with ggplot2
ggplot(gender_data, aes(x = Gender, y = n, fill = Gender)) +
  geom_bar(stat = "identity", width = 0.6)
```
:::

::: {.fragment}
```r
# Step 3: Add text labels and styling
  geom_text(aes(label = label), vjust = -0.5, size = 4) +
  scale_fill_brewer(palette = "Set2") +
  labs(title = "Distribution by Gender", x = "Gender", y = "Frequency") +
  theme(legend.position = "none",
        plot.title = element_text(hjust = 0.5, face = "bold", size = 14))
```
:::

---

## Bar Chart - Plot

```{r bar-chart, fig.width=10, fig.height=6}
gender_data <- df %>%
  count(Gender) %>%
  mutate(
    percentage = n / sum(n) * 100,
    label = paste0(n, "\n(", round(percentage, 1), "%)")
  )

ggplot(gender_data, aes(x = Gender, y = n, fill = Gender)) +
  geom_bar(stat = "identity", width = 0.6) +
  geom_text(aes(label = label), vjust = -0.5, size = 4) +
  scale_fill_brewer(palette = "Set2") +
  labs(title = "Distribution by Gender", 
       x = "Gender", 
       y = "Frequency",
       subtitle = "Shows frequency count and percentage for each gender category") +
  theme(legend.position = "none",
        plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
        plot.subtitle = element_text(hjust = 0.5, size = 11, color = "gray40"))
```

---

## Pie Charts: Description

::: {style="font-size: 22px; line-height: 1.8;"}

### When to Use
- Show proportion/percentage of a whole
- Display parts-to-whole relationships
- Limited to 2-5 categories for clarity

### Requirements
- One categorical variable
- Focus on proportions, not absolute values

### Advantages
✅ Intuitive for showing proportions  
✅ Familiar to most audiences  
✅ Shows relative sizes at a glance  
✅ Good for presenting percentages

### Limitations
❌ Hard to compare similar-sized slices  
❌ Difficult with many categories  
❌ Not suitable for precise value comparison  
❌ Takes significant space

:::

---

## Pie Chart - Code

```r
# Step 1: Prepare data with percentages
region_data <- df %>%
  count(Region) %>%
  mutate(
    percentage = n / sum(n) * 100,
    label = paste0(Region, "\n", n, " (", round(percentage, 1), "%)")
  )
```

::: {.fragment}
```r
# Step 2: Create pie chart using coord_polar
ggplot(region_data, aes(x = "", y = n, fill = Region)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y", start = 0)
```
:::

::: {.fragment}
```r
# Step 3: Add labels and styling
  geom_text(aes(label = label), 
            position = position_stack(vjust = 0.5), size = 3.5) +
  scale_fill_brewer(palette = "Pastel1") +
  labs(title = "Distribution by Region") +
  theme_void() +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14))
```
:::

---

## Pie Chart - Plot

```{r pie-chart, fig.width=10, fig.height=6}
region_data <- df %>%
  count(Region) %>%
  mutate(
    percentage = n / sum(n) * 100,
    label = paste0(Region, "\n", n, " (", round(percentage, 1), "%)")
  )

ggplot(region_data, aes(x = "", y = n, fill = Region)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y", start = 0) +
  geom_text(aes(label = label), 
            position = position_stack(vjust = 0.5), 
            size = 3.5) +
  scale_fill_brewer(palette = "Pastel1") +
  labs(title = "Distribution by Region",
       subtitle = "Pie chart showing proportion of each region in dataset") +
  theme_void() +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
        plot.subtitle = element_text(hjust = 0.5, size = 11, color = "gray40"),
        legend.position = "bottom")
```

---

## Horizontal Bar Chart: Description

::: {style="font-size: 22px; line-height: 1.8;"}

### When to Use
- Display categorical data with long category names
- Improve readability by rotating bars
- Better for comparing values across categories

### Requirements
- One categorical variable with long labels
- Clear ordering (ascending/descending recommended)

### Advantages
✅ Better for long category names  
✅ Easier to read values from axis  
✅ Natural reading flow  
✅ Ordered display improves comparison

### Limitations
❌ Takes more horizontal space  
❌ Axis labels can still overlap if too many

:::

---

## Horizontal Bar Chart - Code

```r
# Step 1: Calculate frequencies and arrange by count
smoking_data <- df %>%
  count(SmokingStatus) %>%
  mutate(
    percentage = n / sum(n) * 100,
    label = paste0(n, " (", round(percentage, 1), "%)")
  ) %>%
  arrange(n)
```

::: {.fragment}
```r
# Step 2: Create horizontal bar chart
ggplot(smoking_data, aes(x = reorder(SmokingStatus, n), 
                        y = n, fill = SmokingStatus)) +
  geom_bar(stat = "identity", width = 0.7) +
  coord_flip()
```
:::

::: {.fragment}
```r
# Step 3: Add labels and styling
  geom_text(aes(label = label), hjust = -0.1, size = 4) +
  scale_fill_brewer(palette = "Set3") +
  labs(title = "Distribution by Smoking Status", 
       x = "Smoking Status", y = "Frequency") +
  theme(legend.position = "none",
        plot.title = element_text(hjust = 0.5, face = "bold", size = 14))
```
:::

---

## Horizontal Bar Chart - Plot

```{r h-bar, fig.width=10, fig.height=6}
smoking_data <- df %>%
  count(SmokingStatus) %>%
  mutate(
    percentage = n / sum(n) * 100,
    label = paste0(n, " (", round(percentage, 1), "%)")
  ) %>%
  arrange(n)

ggplot(smoking_data, aes(x = reorder(SmokingStatus, n), 
                        y = n, fill = SmokingStatus)) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = label), hjust = -0.1, size = 4) +
  coord_flip() +
  scale_fill_brewer(palette = "Set3") +
  labs(title = "Distribution by Smoking Status",
       x = "Smoking Status",
       y = "Frequency",
       subtitle = "Horizontal bars improve readability for long category names") +
  theme(legend.position = "none",
        plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
        plot.subtitle = element_text(hjust = 0.5, size = 11, color = "gray40")) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15)))
```

---

## Donut Charts: Description

::: {style="font-size: 22px; line-height: 1.8;"}

### When to Use
- Show parts-to-whole relationships like pie charts
- Better visual appeal than pie charts
- Add information in center space

### Requirements
- One categorical variable (simple)
- 2-5 categories recommended

### Advantages
✅ More modern look than pie charts  
✅ Center space displays additional info  
✅ Shows proportions effectively  
✅ Good for presentations

### Limitations
❌ Similar issues as pie charts  
❌ Can be cluttered with nested data  
❌ Takes more space than bars

:::

---

## Donut Chart - Code

```r
# Step 1: Calculate data
disease_data <- df %>%
  filter(!is.na(ChronicDisease)) %>%
  count(ChronicDisease) %>%
  mutate(
    percentage = n / sum(n) * 100,
    label = paste0(ChronicDisease, "\n", n, " (", round(percentage, 1), "%)")
  )
```

::: {.fragment}
```r
# Step 2: Create donut shape with coord_polar
ggplot(disease_data, aes(x = 2, y = n, fill = ChronicDisease)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y", start = 0) +
  xlim(0.5, 2.5)
```
:::

::: {.fragment}
```r
# Step 3: Add labels and styling
  geom_text(aes(label = label), 
            position = position_stack(vjust = 0.5), size = 3.5) +
  scale_fill_brewer(palette = "Pastel2") +
  labs(title = "Chronic Disease Distribution") +
  theme_void() +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14))
```
:::

---

## Donut Chart - Plot

```{r donut, fig.width=10, fig.height=6}
disease_data <- df %>%
  filter(!is.na(ChronicDisease)) %>%
  count(ChronicDisease) %>%
  mutate(
    percentage = n / sum(n) * 100,
    label = paste0(ChronicDisease, "\n", n, " (", round(percentage, 1), "%)")
  )

ggplot(disease_data, aes(x = 2, y = n, fill = ChronicDisease)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y", start = 0) +
  geom_text(aes(label = label), 
            position = position_stack(vjust = 0.5), size = 3.5) +
  scale_fill_brewer(palette = "Pastel2") +
  xlim(0.5, 2.5) +
  labs(title = "Chronic Disease Distribution",
       subtitle = "Donut chart showing proportion of chronic diseases in population") +
  theme_void() +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
        plot.subtitle = element_text(hjust = 0.5, size = 11, color = "gray40"),
        legend.position = "right")
```

---

# Two Variable Relationships

## Dodged Bar Chart: Description

::: {style="font-size: 22px; line-height: 1.8;"}

### When to Use
- Compare two categorical variables side-by-side
- Show relationship between two categorical dimensions
- Avoid overlap in bars

### Requirements
- Two categorical variables
- Each with 2-6 categories

### Advantages
✅ Easy side-by-side comparison  
✅ Clear representation of relationships  
✅ Shows both variables simultaneously  
✅ No overlap between bars

### Limitations
❌ Gets crowded with many categories  
❌ Doesn't show proportions (only counts)  
❌ Hard to compare across groups

:::

---

## Dodged Bar Chart - Code

```r
# Step 1: Calculate frequencies
smoking_alcohol_data <- df %>%
  count(SmokingStatus, AlcoholUse) %>%
  group_by(SmokingStatus) %>%
  mutate(
    percentage = n / sum(n) * 100,
    label = paste0(n, "\n(", round(percentage, 1), "%)")
  ) %>%
  ungroup()
```

::: {.fragment}
```r
# Step 2: Create dodged bar chart
ggplot(smoking_alcohol_data, 
       aes(x = SmokingStatus, y = n, fill = AlcoholUse)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7)
```
:::

::: {.fragment}
```r
# Step 3: Add labels and styling
  geom_text(aes(label = label), 
            position = position_dodge(width = 0.7), vjust = -0.5, size = 3.5) +
  scale_fill_manual(values = c("No" = "#66C2A5", "Yes" = "#FC8D62")) +
  labs(title = "Smoking Status by Alcohol Use", 
       x = "Smoking Status", y = "Frequency", fill = "Alcohol Use") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
        legend.position = "top")
```
:::

---

## Dodged Bar Chart - Plot

```{r dodged, fig.width=10, fig.height=6}
smoking_alcohol_data <- df %>%
  count(SmokingStatus, AlcoholUse) %>%
  group_by(SmokingStatus) %>%
  mutate(
    percentage = n / sum(n) * 100,
    label = paste0(n, "\n(", round(percentage, 1), "%)")
  ) %>%
  ungroup()

ggplot(smoking_alcohol_data, 
       aes(x = SmokingStatus, y = n, fill = AlcoholUse)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_text(aes(label = label), 
            position = position_dodge(width = 0.7), vjust = -0.5, size = 3.5) +
  scale_fill_manual(values = c("No" = "#66C2A5", "Yes" = "#FC8D62")) +
  labs(title = "Smoking Status by Alcohol Use",
       x = "Smoking Status",
       y = "Frequency",
       fill = "Alcohol Use",
       subtitle = "Dodged bars enable side-by-side comparison of two categorical variables") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
        plot.subtitle = element_text(hjust = 0.5, size = 11, color = "gray40"),
        legend.position = "top")
```

---

## Stacked Bar (Count): Description

::: {style="font-size: 22px; line-height: 1.8;"}

### When to Use
- Compare totals across groups
- Show composition within each group
- Display hierarchical relationships

### Requirements
- Two categorical variables
- Interest in both individual and total counts

### Advantages
✅ Shows both composition and totals  
✅ Easy to compare group totals  
✅ Compact representation  
✅ Good for showing contributions

### Limitations
❌ Hard to compare middle/top segments  
❌ Doesn't show proportions clearly  
❌ Can be misleading with very different group sizes

:::

---

## Stacked Bar (Count) - Code

```r
# Step 1: Calculate frequencies
region_smoking_data <- df %>%
  count(Region, SmokingStatus) %>%
  group_by(Region) %>%
  mutate(
    percentage = n / sum(n) * 100,
    label = ifelse(percentage > 5, 
                   paste0(n, "\n(", round(percentage, 1), "%)"), "")
  ) %>%
  ungroup()
```

::: {.fragment}
```r
# Step 2: Create stacked bar chart
ggplot(region_smoking_data, 
       aes(x = Region, y = n, fill = SmokingStatus)) +
  geom_bar(stat = "identity", width = 0.7)
```
:::

::: {.fragment}
```r
# Step 3: Add labels and styling
  geom_text(aes(label = label), 
            position = position_stack(vjust = 0.5), size = 3,
            color = "white", fontface = "bold") +
  scale_fill_brewer(palette = "Set2") +
  labs(title = "Region by Smoking Status (Count)", x = "Region", y = "Frequency") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
        legend.position = "top")
```
:::

---

## Stacked Bar (Count) - Plot

```{r stacked-count, fig.width=10, fig.height=6}
region_smoking_data <- df %>%
  count(Region, SmokingStatus) %>%
  group_by(Region) %>%
  mutate(
    percentage = n / sum(n) * 100,
    label = ifelse(percentage > 5, 
                   paste0(n, "\n(", round(percentage, 1), "%)"), "")
  ) %>%
  ungroup()

ggplot(region_smoking_data, 
       aes(x = Region, y = n, fill = SmokingStatus)) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = label), 
            position = position_stack(vjust = 0.5), size = 3,
            color = "white", fontface = "bold") +
  scale_fill_brewer(palette = "Set2") +
  labs(title = "Region by Smoking Status (Absolute Count)",
       x = "Region",
       y = "Frequency",
       fill = "Smoking Status",
       subtitle = "Stacked bars show composition and totals simultaneously") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
        plot.subtitle = element_text(hjust = 0.5, size = 11, color = "gray40"),
        legend.position = "top")
```

---

## Stacked Bar (Proportion): Description

::: {style="font-size: 22px; line-height: 1.8;"}

### When to Use
- Compare proportions/percentages across groups
- Show relative composition (0-100%)
- Compare distributions when group sizes differ

### Requirements
- Two categorical variables
- Focus on proportions, not absolute counts

### Advantages
✅ Easy to compare proportions across groups  
✅ Accounts for different group sizes  
✅ All bars same height (100%)  
✅ Clear compositional comparison

### Limitations
❌ Loses information about group sizes  
❌ Hard to compare exact proportions  
❌ Middle segments still hard to compare

:::

---

## Stacked Bar (Proportion) - Code

```r
# Step 1: Calculate proportions (0-1 scale)
region_smoking_prop <- df %>%
  count(Region, SmokingStatus) %>%
  group_by(Region) %>%
  mutate(
    prop = n / sum(n),
    percentage = prop * 100,
    label = paste0(round(percentage, 1), "%")
  ) %>%
  ungroup()
```

::: {.fragment}
```r
# Step 2: Create 100% stacked bar chart
ggplot(region_smoking_prop, 
       aes(x = Region, y = prop, fill = SmokingStatus)) +
  geom_bar(stat = "identity", width = 0.7)
```
:::

::: {.fragment}
```r
# Step 3: Format and style
  geom_text(aes(label = label), 
            position = position_stack(vjust = 0.5), size = 3.5,
            color = "white", fontface = "bold") +
  scale_y_continuous(labels = scales::percent) +
  scale_fill_brewer(palette = "Set2") +
  labs(title = "Region by Smoking Status (Proportion 0-100%)",
       x = "Region", y = "Proportion", fill = "Smoking Status") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
        legend.position = "top")
```
:::

---

## Stacked Bar (Proportion) - Plot

```{r stacked-prop, fig.width=10, fig.height=6}
region_smoking_prop <- df %>%
  count(Region, SmokingStatus) %>%
  group_by(Region) %>%
  mutate(
    prop = n / sum(n),
    percentage = prop * 100,
    label = paste0(round(percentage, 1), "%")
  ) %>%
  ungroup()

ggplot(region_smoking_prop, 
       aes(x = Region, y = prop, fill = SmokingStatus)) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = label), 
            position = position_stack(vjust = 0.5), size = 3.5,
            color = "white", fontface = "bold") +
  scale_y_continuous(labels = scales::percent) +
  scale_fill_brewer(palette = "Set2") +
  labs(title = "Region by Smoking Status (Normalized to 100%)",
       x = "Region",
       y = "Proportion",
       fill = "Smoking Status",
       subtitle = "100% stacked bars normalize values, making proportions easily comparable") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
        plot.subtitle = element_text(hjust = 0.5, size = 11, color = "gray40"),
        legend.position = "top")
```

---

## Exploded Pie Chart: Description

::: {style="font-size: 22px; line-height: 1.8;"}

### When to Use
- Emphasize one or more categories
- Show parts-to-whole with visual emphasis
- Highlight important segments

### Requirements
- One categorical variable with 2-6 categories
- Need to emphasize specific slice

### Advantages
✅ Draws attention to specific category  
✅ More engaging than standard pie  
✅ Good for presentations  
✅ Shows proportions clearly

### Limitations
❌ Can be misleading (emphasized slice appears larger)  
❌ Difficult to maintain visual accuracy  
❌ Similar issues as pie charts

:::

---

## Exploded Pie Chart - Code

```r
# Step 1: Calculate frequencies and percentages
treatment_data <- df %>%
  count(TreatmentGroup) %>%
  mutate(percentage = n / sum(n) * 100)

labels <- paste0(treatment_data$TreatmentGroup, "\n", 
                 treatment_data$n, " (", 
                 round(treatment_data$percentage, 1), "%)")
```

::: {.fragment}
```r
# Step 2: Create exploded pie using plotrix
par(mar = c(1, 1, 3, 1))
pie3D(treatment_data$n, 
      labels = labels,
      explode = 0.1,
      col = c("#8DD3C7", "#FFFFB3"))
```
:::

::: {.fragment}
```r
# Step 3: Add title and formatting
      main = "Treatment Group Distribution (Exploded)",
      cex.main = 1.2,
      labelcex = 1,
      theta = 1.2
```
:::

---

## Exploded Pie Chart - Plot

```{r exploded, fig.width=10, fig.height=6}
treatment_data <- df %>%
  count(TreatmentGroup) %>%
  mutate(percentage = n / sum(n) * 100)

labels <- paste0(treatment_data$TreatmentGroup, "\n", 
                 treatment_data$n, " (", 
                 round(treatment_data$percentage, 1), "%)")

par(mar = c(2, 1, 3, 1))
pie3D(treatment_data$n, 
      labels = labels,
      explode = 0.1,
      col = c("#8DD3C7", "#FFFFB3"),
      main = "Treatment Group Distribution (Exploded Pie)",
      cex.main = 1.3,
      labelcex = 1.1,
      theta = 1.2)
```

---

# Complex Relationships

## Triple Donut: Description

::: {style="font-size: 22px; line-height: 1.8;"}

### When to Use
- Show hierarchical or nested categorical relationships
- Compare three categories simultaneously
- Display proportions at multiple levels

### Requirements
- Two categorical variables (rings and nested categories)
- Interest in hierarchical proportions

### Advantages (Concentric)
✅ Shows multiple dimensions compactly  
✅ Hierarchical clarity  
✅ Visually interesting  
✅ Good for storytelling

### Limitations (Concentric)
❌ Very difficult to compare rings  
❌ Can be visually confusing  
❌ Hard to interpret proportions accurately  
❌ Limited to 3-4 rings maximum

:::

---

## Triple Donut - Code

```r
# Prepare three separate datasets for ring positions
diabetes_df <- df %>%
  filter(ChronicDisease == "Diabetes" & !is.na(ExerciseFreq)) %>%
  count(ExerciseFreq) %>%
  mutate(disease = "Diabetes", x = 0.5)

htn_df <- df %>%
  filter(ChronicDisease == "Hypertension" & !is.na(ExerciseFreq)) %>%
  count(ExerciseFreq) %>%
  mutate(disease = "Hypertension", x = 0.7)

heart_df <- df %>%
  filter(ChronicDisease == "Heart Disease" & !is.na(ExerciseFreq)) %>%
  count(ExerciseFreq) %>%
  mutate(disease = "Heart Disease", x = 0.9)

combined <- bind_rows(diabetes_df, htn_df, heart_df)
```

::: {.fragment}
```r
# Create three bars at different positions
ggplot(combined, aes(fill = ExerciseFreq, y = n)) +
  geom_bar(data = filter(combined, disease == "Diabetes"),
           aes(x = 0.5), stat = "identity", width = 0.2, 
           color = "white", size = 0.5) +
  geom_bar(data = filter(combined, disease == "Hypertension"),
           aes(x = 0.7), stat = "identity", width = 0.2,
           color = "white", size = 0.5) +
  geom_bar(data = filter(combined, disease == "Heart Disease"),
           aes(x = 0.9), stat = "identity", width = 0.2,
           color = "white", size = 0.5)
```
:::

::: {.fragment}
```r
# Convert to polar and style
+ coord_polar(theta = "y") +
  xlim(c(0.2, 1.0)) +
  scale_fill_manual(values = c("Daily" = "#66BB6A",
                               "3-5 times/week" = "#90CAF9",
                               "1-2 times/week" = "#F48FB1")) +
  labs(title = "Exercise Frequency by Chronic Disease",
       fill = "Exercise") +
  theme_void() +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
        legend.position = "right")
```
:::

---

## Triple Donut - Plot

```{r triple-donut, fig.width=10, fig.height=6}
diabetes_df <- df %>%
  filter(ChronicDisease == "Diabetes" & !is.na(ExerciseFreq)) %>%
  count(ExerciseFreq) %>%
  mutate(disease = "Diabetes", x = 0.5)

htn_df <- df %>%
  filter(ChronicDisease == "Hypertension" & !is.na(ExerciseFreq)) %>%
  count(ExerciseFreq) %>%
  mutate(disease = "Hypertension", x = 0.7)

heart_df <- df %>%
  filter(ChronicDisease == "Heart Disease" & !is.na(ExerciseFreq)) %>%
  count(ExerciseFreq) %>%
  mutate(disease = "Heart Disease", x = 0.9)

combined <- bind_rows(diabetes_df, htn_df, heart_df)

ggplot(combined, aes(fill = ExerciseFreq, y = n)) +
  geom_bar(data = filter(combined, disease == "Diabetes"),
           aes(x = 0.5), stat = "identity", width = 0.2, color = "white", size = 0.5) +
  geom_bar(data = filter(combined, disease == "Hypertension"),
           aes(x = 0.7), stat = "identity", width = 0.2, color = "white", size = 0.5) +
  geom_bar(data = filter(combined, disease == "Heart Disease"),
           aes(x = 0.9), stat = "identity", width = 0.2, color = "white", size = 0.5) +
  coord_polar(theta = "y") +
  xlim(c(0.2, 1.0)) +
  scale_fill_manual(
    values = c("Daily" = "#66BB6A",
               "3-5 times/week" = "#90CAF9",
               "1-2 times/week" = "#F48FB1"),
    name = "Exercise Frequency"
  ) +
  labs(title = "Exercise Frequency by Chronic Disease",
       subtitle = "Inner: Diabetes | Middle: Hypertension | Outer: Heart Disease") +
  theme_void() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
    plot.subtitle = element_text(hjust = 0.5, size = 11, color = "gray40"),
    legend.position = "right",
    legend.title = element_text(face = "bold")
  )
```

---

## Mosaic Plot: Description

::: {style="font-size: 22px; line-height: 1.8;"}

### When to Use
- Display relationships between 2+ categorical variables
- Show proportions in contingency tables
- Identify associations between variables

### Requirements
- Multiple categorical variables (2-4 typically)
- Can handle unbalanced data

### How to Interpret
- **Tile width**: First variable proportion
- **Tile height**: Second variable conditional proportion
- **Tile area**: Combined proportion
- **Empty space**: Cells with low frequency
- **Color intensity**: Strength of association

### Advantages
✅ Shows multi-dimensional relationships  
✅ Displays proportions simultaneously  
✅ Highlights sparse cells  
✅ Visual independence test

:::

---

## Mosaic Plot - Code

```r
# Step 1: Prepare data and remove NAs
mosaic_data <- df %>%
  filter(!is.na(AlcoholUse)) %>%
  select(TreatmentGroup, Gender, SmokingStatus, AlcoholUse)

# Create contingency table
mosaic_table <- xtabs(~ TreatmentGroup + Gender + 
                        SmokingStatus + AlcoholUse, 
                      data = mosaic_data)
```

::: {.fragment}
```r
# Step 2: Create mosaic plot using vcd package
mosaic(mosaic_table,
       main = "Mosaic Plot: 4-way Relationship",
       highlighting = "AlcoholUse",
       highlighting_fill = c("#8DD3C7", "#FB8072"),
       direction = c("v", "v", "h", "h"))
```
:::

::: {.fragment}
```r
# Step 3: Add labels and formatting
       spacing = spacing_highlighting,
       labeling = labeling_border(rot_labels = c(45, 0, 0, 0),
                                  just_labels = c("right", "center", 
                                                  "center", "center"),
                                  varnames = TRUE,
                                  abbreviate_labs = TRUE)
```
:::

---

## Mosaic Plot - Output

```{r mosaic, fig.width=12, fig.height=7}
mosaic_data <- df %>%
  filter(!is.na(AlcoholUse)) %>%
  select(TreatmentGroup, Gender, SmokingStatus, AlcoholUse)

mosaic_table <- xtabs(~ TreatmentGroup + Gender + SmokingStatus + AlcoholUse, 
                      data = mosaic_data)

par(mar = c(4, 4, 3, 2))
mosaic(mosaic_table,
       main = "Mosaic Plot: Treatment × Gender × Smoking × Alcohol Use",
       highlighting = "AlcoholUse",
       highlighting_fill = c("#8DD3C7", "#FB8072"),
       direction = c("v", "v", "h", "h"),
       spacing = spacing_highlighting,
       labeling = labeling_border(rot_labels = c(45, 0, 0, 0),
                                  just_labels = c("right", "center", "center", "center"),
                                  varnames = TRUE,
                                  abbreviate_labs = TRUE))
```

---

# Summary & Best Practices

## Choosing the Right Plot

::: {style="font-size: 22px; line-height: 1.8;"}

### Single Variable
**Bar** → Pie → Horizontal Bar → Donut

### Two Variables
**Dodged** → Stacked Count → Stacked Proportion

### Complex/Hierarchical
**Exploded Pie** → Triple Donut → Mosaic

### Key Decision Points
1. **How many variables?** (1, 2, 3+)
2. **What's your message?** (counts vs proportions)
3. **Who's the audience?** (technical vs general)
4. **Show relationships or distributions?**

:::

---

## Best Practices

::: {style="font-size: 22px; line-height: 1.8;"}

### Do's ✅
- Keep labels clear and complete
- Use color meaningfully (not randomly)
- Order categories logically
- Include percentages with counts
- Choose the simplest effective plot
- Test readability at presentation size

### Don'ts ❌
- Avoid 3D effects (distort perception)
- Don't use too many colors
- Avoid misleading axis scales
- Don't overcrowd with too many categories
- Never remove axis labels
- Don't use pie charts for 5+ categories

:::

---

## Questions & Discussion

::: {style="text-align: center; font-size: 28px; margin-top: 150px;"}

**Thank You!**

**Categorical Base Plots**

**For Questions: Contact or References**

:::
